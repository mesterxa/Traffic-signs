<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Traffic Quiz â€“ DriveLearn</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --primary:#2563eb;
  --primary-dark:#1e40af;
  --bg:#f8fafc;
  --card:#ffffff;
  --radius:16px;
}

body{
  margin:0;
  font-family:"Segoe UI",system-ui;
  background:var(--bg);
}

header{
  background:linear-gradient(135deg,var(--primary),var(--primary-dark));
  color:white;
  padding:16px;
  text-align:center;
  font-size:20px;
  font-weight:700;
}

.quiz-card{
  background:var(--card);
  max-width:420px;
  margin:40px auto;
  padding:26px;
  border-radius:var(--radius);
  box-shadow:0 15px 35px rgba(0,0,0,.15);
  text-align:center;
}

.quiz-card img{
  width:140px;
  margin-bottom:15px;
}

.options button{
  width:100%;
  padding:13px;
  margin:8px 0;
  border:none;
  border-radius:12px;
  background:var(--primary);
  color:white;
  font-size:16px;
  cursor:pointer;
}

.options button:hover{
  background:var(--primary-dark);
}

.info{
  margin-top:12px;
  color:#555;
  font-size:14px;
}

/* Modals */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:10;
}

.modal.show{ display:flex; }

.modal-card{
  background:white;
  width:90%;
  max-width:360px;
  padding:26px;
  border-radius:18px;
  text-align:center;
}

.icon{
  font-size:58px;
}

.modal-actions{
  display:flex;
  gap:10px;
  margin-top:22px;
}

.modal-actions button{
  flex:1;
  padding:12px;
  border:none;
  border-radius:12px;
  font-size:15px;
  cursor:pointer;
}

#retryBtn,#restartExam{ background:#e5e7eb; }
#nextBtn{ background:#16a34a;color:white; }
#reviewBtn,#reviewSigns{ background:var(--primary);color:white; }
</style>
</head>

<body>

<header>ğŸš¦ Traffic Quiz</header>

<div class="quiz-card">
  <img id="signImage">
  <div class="options" id="options"></div>
  <div class="info" id="info"></div>
</div>

<!-- Answer Modal -->
<div id="resultModal" class="modal">
  <div class="modal-card">
    <div class="icon" id="resultIcon"></div>
    <h3 id="resultTitle"></h3>
    <p id="resultText"></p>
    <div class="modal-actions">
      <button id="retryBtn">ğŸ” Retry</button>
      <button id="nextBtn">â¡ï¸ Next</button>
      <button id="reviewBtn">ğŸ“˜ Review</button>
    </div>
  </div>
</div>

<!-- Final Modal -->
<div id="finalModal" class="modal">
  <div class="modal-card">
    <div class="icon" id="finalIcon"></div>
    <h3 id="finalTitle"></h3>
    <p id="finalText"></p>
    <div class="modal-actions">
      <button id="restartExam">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
      <button id="reviewSigns">ğŸ“˜ Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</button>
    </div>
  </div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAukmQBNFxX_AhpxYOQfDVtGux07OkzN6Q",
  authDomain: "traffic-signs-fc047.firebaseapp.com",
  projectId: "traffic-signs-fc047",
  storageBucket: "traffic-signs-fc047.appspot.com",
  messagingSenderId: "746457575630",
  appId: "1:746457575630:web:3219b85b64e2307126609f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;

onAuthStateChanged(auth, user=>{
  if(!user) location.href="login.html";
  currentUser = user;
});

/* Questions */
const questions = [
  {id:"stop",img:"https://upload.wikimedia.org/wikipedia/commons/2/2f/Stop_sign.svg",options:["Stop","No entry","Parking"],answer:"Stop"},
  {id:"no-entry",img:"https://upload.wikimedia.org/wikipedia/commons/6/6f/No_entry.svg",options:["Stop","No entry","Danger"],answer:"No entry"},
  {id:"pedestrians",img:"https://upload.wikimedia.org/wikipedia/commons/5/55/Children_crossing.svg",options:["School","Pedestrians","Children"],answer:"Children"}
];

let index=0, score=0;

/* DOM */
const signImage = signImageEl = document.getElementById("signImage");
const optionsBox = document.getElementById("options");
const info = document.getElementById("info");

/* Load Question */
function loadQuestion(){
  const q = questions[index];
  signImage.src = q.img;
  optionsBox.innerHTML="";
  info.textContent = `Question ${index+1}/${questions.length} | Score: ${score}/30`;

  q.options.forEach(o=>{
    const b=document.createElement("button");
    b.textContent=o;
    b.onclick=()=>checkAnswer(o);
    optionsBox.appendChild(b);
  });
}

/* Answer */
function checkAnswer(ans){
  resultModal.classList.add("show");
  if(ans===questions[index].answer){
    score+=10;
    resultIcon.textContent="âœ…";
    resultTitle.textContent="Correct!";
    resultText.textContent="Good job ğŸš—";
  }else{
    resultIcon.textContent="âŒ";
    resultTitle.textContent="Wrong!";
    resultText.textContent="Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©";
  }
}

/* Navigation */
retryBtn.onclick=()=>resultModal.classList.remove("show");

reviewBtn.onclick=()=>{
  location.href=`signs.html?sign=${questions[index].id}`;
};

nextBtn.onclick=()=>{
  resultModal.classList.remove("show");
  index++;
  index<questions.length ? loadQuestion() : showFinal();
};

/* Final */
async function showFinal(){
  finalModal.classList.add("show");

  const passed = score >= 20;

  finalIcon.textContent = passed ? "ğŸ‰" : "ğŸ“˜";
  finalTitle.textContent = passed ? "ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!" : "ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø©";
  finalText.textContent = `Ù†ØªÙŠØ¬ØªÙƒ: ${score}/30`;

  /* ğŸ”¥ SAVE RESULT */
  await setDoc(doc(db,"results",currentUser.uid),{
    uid: currentUser.uid,
    email: currentUser.email,
    score,
    passed,
    total: 30,
    createdAt: new Date()
  });

  restartExam.onclick=()=>location.reload();
  reviewSigns.onclick=()=>location.href="signs.html";
}

loadQuestion();
</script>

</body>
</html>