<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DriveLearn ‚Äì Teacher Panel</title>

<style>
body{
  margin:0;
  font-family:"Segoe UI",system-ui,sans-serif;
  background:#f8fafc;
}

.navbar{
  background:#2563eb;
  color:white;
  padding:14px 24px;
  font-size:18px;
  font-weight:700;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logout{
  background:white;
  color:#2563eb;
  border:none;
  padding:8px 16px;
  border-radius:999px;
  font-weight:700;
  cursor:pointer;
}

.container{
  max-width:1100px;
  margin:50px auto;
  padding:0 20px;
}

table{
  width:100%;
  border-collapse:collapse;
  background:white;
  border-radius:14px;
  overflow:hidden;
  box-shadow:0 14px 35px rgba(0,0,0,.12);
}

th,td{
  padding:14px;
  border-bottom:1px solid #e5e7eb;
  text-align:center;
}

th{
  background:#1e40af;
  color:white;
}

.pass{color:#16a34a;font-weight:700}
.fail{color:#dc2626;font-weight:700}

input{
  width:90%;
  padding:8px;
  border-radius:6px;
  border:1px solid #cbd5f5;
}
</style>
</head>

<body>

<div class="navbar">
  üë®‚Äçüè´ Teacher Dashboard
  <button class="logout" onclick="logout()">Logout</button>
</div>

<div class="container">
  <table>
    <thead>
      <tr>
        <th>Student</th>
        <th>Email</th>
        <th>Score</th>
        <th>Note</th>
        <th>Result</th>
      </tr>
    </thead>
    <tbody id="table">
      Loading...
    </tbody>
  </table>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAukmQBNFxX_AhpxYOQfDVtGux07OkzN6Q",
  authDomain: "traffic-signs-fc047.firebaseapp.com",
  projectId: "traffic-signs-fc047"
};

const TEACHER_EMAIL = "aymenmed25071999@gmail.com";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const table = document.getElementById("table");

/* üîê PROTECTION */
onAuthStateChanged(auth, async user => {

  if (!user) {
    location.href = "login.html";
    return;
  }

  const snap = await getDoc(doc(db,"users",user.uid));
  const data = snap.data();

  /* ŸÖŸÜÿπ ÿßŸÑÿ∑ÿßŸÑÿ® */
  if (user.email !== TEACHER_EMAIL && data.role !== "teacher") {
    location.href = "index.html";
    return;
  }

  loadStudents();
});

async function loadStudents(){
  const snap = await getDocs(collection(db,"users"));
  table.innerHTML = "";

  snap.forEach(d=>{
    const u = d.data();

    if(u.role === "teacher") return;

    table.innerHTML += `
      <tr>
        <td>${u.firstName ?? ""} ${u.lastName ?? ""}</td>
        <td>${u.email}</td>
        <td>${u.score ?? "-"}</td>
        <td>
          <input
            value="${u.note ?? ""}"
            placeholder="Teacher note"
            onchange="saveNote('${d.id}',this.value)">
        </td>
        <td class="${u.result==="Passed"?"pass":"fail"}">
          ${u.result ?? "Pending"}
        </td>
      </tr>
    `;
  });
}

window.saveNote = async (id,note)=>{
  await updateDoc(doc(db,"users",id),{note});
};

window.logout = async ()=>{
  await signOut(auth);
  location.href="login.html";
};
</script>

</body>
</html>